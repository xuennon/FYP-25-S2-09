<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaderboard Management - Wise Fitness</title>
  <style>
    /* Ensure all challenge type widgets are the same size */
    .challenge-type-btn {
      width: 95%;
      height: 140px;
      min-width: 340px;
      min-height: 140px;
      max-width: 440px;
      max-height: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: linear-gradient(135deg, #f7f9fb 80%, #eaf3fb 100%);
      color: #222;
      border: 2.5px solid #e0e0e0;
      border-radius: 22px;
      padding: 24px 16px 16px 16px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      outline: none;
      box-shadow: 0 4px 18px rgba(0,0,0,0.08);
      text-align: center;
      margin-bottom: 0;
      transition: box-shadow 0.22s, background 0.22s, color 0.22s, border 0.22s, transform 0.18s;
      user-select: none;
      position: relative;
    }
    .challenge-type-btn.selected, .challenge-type-btn:focus {
      background: var(--primary);
      color: #fff;
      border: 2.5px solid #005bb5;
      box-shadow: 0 8px 28px rgba(0,123,255,0.22);
      outline: 2.5px solid #fff;
      transform: scale(1.01);
      z-index: 1;
    }
    .challenge-type-btn.selected .ct-title,
    .challenge-type-btn.selected .ct-desc,
    .challenge-type-btn.selected .ct-icon {
      color: #fff !important;
    }
    .challenge-type-btn.selected .ct-icon {
      text-shadow: 0 2px 8px #005bb5;
    }
    .challenge-type-btn.selected::after {
      content: '\2714';
      position: absolute;
      top: 16px;
      right: 32px;
      font-size: 22px;
      color: #fff;
      background: #007bff;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 6px rgba(0,0,0,0.14);
      border: 2.5px solid #fff;
      animation: popIn 0.25s cubic-bezier(.4,2,.6,1);
    }
    .challenge-type-btn:hover:not(.selected) {
      background: #e6f0fa;
      color: var(--primary);
      border: 2.5px solid #b3d4fc;
      box-shadow: 0 6px 18px rgba(0,123,255,0.13);
      transform: translateY(-2px) scale(1.01);
    }
    .ct-widget {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100%;
      width: 100%;
    }
    .ct-widget-text {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      flex: 1 1 auto;
      width: 100%;
      min-height: 80px;
    }
    :root {
      --primary: #007bff;
      --light-bg: #f9f9f9;
      --dark-bg: #1f1f1f;
      --card-bg: #ffffff;
      --card-dark: #2c2c2c;
      --text-light: #111;
      --text-dark: #f1f1f1;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --radius: 14px;
      --transition: 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      background: var(--light-bg);
      color: var(--text-light);
      transition: var(--transition);
      overflow-x: hidden;
    }

    body.dark {
      background: var(--dark-bg);
      color: var(--text-dark);
    }


    /* Toolbar styles (from Posts.html/Events.html) */
    header.toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #0066cc;
      padding: 8px 16px;
      color: white;
      border-radius: 5px;
      user-select: none;
      margin-bottom: 20px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 20;
      height: 56px;
    }
    header.toolbar > div {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    header.toolbar button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      user-select: none;
    }
    #backBtn {
      font-size: 24px;
      padding: 0;
      line-height: 1;
    }
    #modeToggle {
      font-size: 20px;
    }
    #menuBtn {
      font-size: 24px;
    }
    header.toolbar span.title {
      font-weight: 600;
      font-size: 18px;
    }

    /* Side Menu styles (from Posts.html/Events.html) */
    #sideMenuOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.4);
      z-index: 1500;
      transition: opacity 0.3s ease;
    }
    #sideMenuOverlay.active {
      display: block;
    }
    #sideMenu {
      position: fixed;
      top: 0;
      right: -280px;
      left: auto;
      width: 280px;
      height: 100vh;
      background-color: #004a99;
      color: white;
      padding: 20px;
      box-sizing: border-box;
      box-shadow: -2px 0 8px rgba(0,0,0,0.3);
      transition: right 0.3s ease;
      z-index: 1600;
      display: flex;
      flex-direction: column;
    }
    #sideMenu.active {
      right: 0;
      left: auto;
    }
    #sideMenu h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-weight: 700;
      font-size: 22px;
    }
    #sideMenu nav a {
      color: white;
      text-decoration: none;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      cursor: pointer;
      font-size: 16px;
      display: block;
    }
    #sideMenu nav a:hover {
      background: rgba(255,255,255,0.1);
    }
    #sideMenu button#closeMenuBtn {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      align-self: flex-end;
      cursor: pointer;
      margin-bottom: 10px;
    }

    /* Responsive for mobile (from Posts.html/Events.html) */
    @media (max-width: 480px) {
      header.toolbar {
        padding: 6px 12px;
      }
      header.toolbar button#backBtn,
      header.toolbar button#menuBtn {
        font-size: 20px;
      }
      header.toolbar button#modeToggle {
        font-size: 18px;
      }
      header.toolbar span.title {
        font-size: 16px;
      }
      #sideMenu {
        width: 220px;
      }
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 20px 40px;
      min-height: 100vh;
      transition: padding-right 0.3s ease;
      padding-right: 20px;
    }

    .sidebar-active .container {
      padding-right: 280px;
    }

    .header {
      background: var(--primary);
      color: white;
      padding: 16px 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: var(--radius) var(--radius) 0 0;
      box-shadow: var(--shadow);
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      height: 56px;
      z-index: 20;
      transition: right 0.3s ease, width 0.3s ease;
      user-select: none;
    }

    .sidebar-active .header {
      right: 260px;
      width: calc(100% - 260px);
    }

    .header span {
      font-size: 22px;
      font-weight: 600;
    }

    .toggle-mode {
      cursor: pointer;
      font-size: 22px;
      background: none;
      border: none;
      color: white;
      user-select: none;
      margin-right: 16px;
    }

    .menu-icon {
      font-size: 26px;
      cursor: pointer;
      user-select: none;
    }

    .content {
      margin-top: 80px;
    }

    /* Leaderboard specific styles */
    .leaderboard-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .leaderboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .leaderboard-header h2 {
      color: var(--primary);
      font-size: 28px;
    }

    .create-leaderboard-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .create-leaderboard-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);
    }

    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card-bg);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    body.dark .leaderboard-table {
      background: var(--card-dark);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    }

    .leaderboard-table th,
    .leaderboard-table td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    body.dark .leaderboard-table th,
    body.dark .leaderboard-table td {
      border-bottom: 1px solid #444;
    }

    .leaderboard-table th {
      background-color: var(--primary);
      color: white;
      font-weight: 600;
    }

    .leaderboard-table tr:last-child td {
      border-bottom: none;
    }

    .leaderboard-table tr:hover {
      background-color: rgba(0, 123, 255, 0.1);
    }

    body.dark .leaderboard-table tr:hover {
      background-color: rgba(0, 123, 255, 0.2);
    }

    .leaderboard-actions {
      display: flex;
      gap: 6px;
      justify-content: center;
      align-items: center;
    }
    .action-btn {
      padding: 7px 13px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.18s, box-shadow 0.18s, transform 0.13s;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
      outline: none;
    }
    .action-btn:active {
      transform: scale(0.97);
    }

    .view-btn {
      background: #28a745;
      color: #fff;
      border: 1.5px solid #28a745;
    }
    .view-btn:hover {
      background: #218838;
      color: #fff;
      border-color: #218838;
    }

    .edit-btn {
      background: #ffc107;
      color: #111;
      border: 1.5px solid #ffc107;
    }
    .edit-btn:hover {
      background: #e0a800;
      color: #111;
      border-color: #e0a800;
    }

    .delete-btn {
      background: #dc3545;
      color: white !important;
      border: 1.5px solid #f5b7b7;
    }
    .delete-btn:hover {
      background: #c82333;
      color: white !important;
      border-color: #dc3545;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 40;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    body.dark .modal-content {
      background: var(--card-dark);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h3 {
      color: var(--primary);
      font-size: 22px;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-light);
    }

    body.dark .close-btn {
      color: var(--text-dark);
    }


    /* Improved form group styles for neater look */
    .form-group {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
      font-size: 15.5px;
      color: #222;
      letter-spacing: 0.01em;
    }
    body.dark .form-group label {
      color: #f1f1f1;
    }
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1.5px solid #cfd8dc;
      font-family: inherit;
      font-size: 16px;
      background: #f7f9fb;
      color: #222;
      transition: border 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .form-group input:focus,
    .form-group textarea:focus {
      border: 1.5px solid var(--primary);
      outline: none;
      box-shadow: 0 2px 8px rgba(0,123,255,0.10);
      background: #eaf3fb;
    }
    body.dark .form-group input,
    body.dark .form-group textarea {
      background: #23272b;
      color: #f1f1f1;
      border-color: #444;
    }
    body.dark .form-group input:focus,
    body.dark .form-group textarea:focus {
      background: #1f2327;
      border-color: var(--primary);
    }
    .form-group textarea {
      min-height: 90px;
      resize: vertical;
    }

    /* Improved submit button styles */
    .submit-btn {
      background: linear-gradient(90deg, var(--primary) 80%, #005bb5 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 0;
      font-size: 16.5px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 0;
      width: 100%;
      box-shadow: 0 2px 8px rgba(0,123,255,0.08);
      letter-spacing: 0.01em;
      transition: background 0.2s, box-shadow 0.2s, filter 0.2s;
      outline: none;
    }
    .submit-btn:active {
      filter: brightness(0.93);
    }
    .submit-btn:disabled {
      background: #b3d4fc;
      color: #fff;
      cursor: not-allowed;
      opacity: 0.7;
    }
    .submit-btn:hover:not(:disabled) {
      background: linear-gradient(90deg, #005bb5 80%, var(--primary) 100%);
      box-shadow: 0 4px 16px rgba(0,123,255,0.13);
    }

    /* Modal step label improvements */
  

    .modal-step > label {
      font-size: 17px !important;
      font-weight: 700 !important;
      margin-bottom: 16px !important;
      color: #111 !important;
      letter-spacing: 0.01em;
    }
    body.dark .modal-step > label {
      color: #f1f1f1 !important;
    }

    /* Modal step button row improvements */
    .modal-step > div[style*="display:flex"] {
      gap: 12px;
    }

    /* Metrics and sports options improvements */
    .metrics-options label, .sports-options label {
      font-size: 15.5px;
      margin-bottom: 4px;
      padding: 7px 0 7px 2px;
      border-radius: 7px;
      transition: background 0.18s;
      display: flex;
      align-items: center;
      gap: 7px;
      cursor: pointer;
    }
    .metrics-options label:hover, .sports-options label:hover {
      background: #eaf3fb;
    }
    body.dark .metrics-options label:hover, body.dark .sports-options label:hover {
      background: #23272b;
    }
    .metrics-options input[type="checkbox"], .sports-options input[type="checkbox"] {
      accent-color: var(--primary);
      margin-right: 8px;
      width: 18px;
      height: 18px;
    }

    /* Modal content padding for mobile */
    @media (max-width: 600px) {
      .modal-content {
        padding: 14px 6px 18px 6px;
        max-width: 99vw;
      }
      .form-group input, .form-group textarea {
        font-size: 15px;
        padding: 10px 8px;
      }
      .submit-btn {
        font-size: 15px;
        padding: 10px 0;
      }
    }

    @media (max-width: 900px) {
      .container {
        padding-right: 20px !important;
      }

      .sidebar {
        width: 260px;
        height: 100vh;
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .header, .sidebar-active .header {
        right: 0 !important;
        width: 100% !important;
      }

      .leaderboard-table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>

<body>

  <header class="toolbar" role="banner" aria-label="Page toolbar">
    <div>
      <button id="backBtn" aria-label="Go back" title="Go back">←</button>
      <span class="title" id="headerTitle">Leaderboard Management</span>
    </div>
    <div>
      <button id="modeToggle" aria-label="Toggle light/dark mode" title="Toggle light/dark mode">🌙</button>
      <button id="menuBtn" aria-label="Open menu" title="Open menu">☰</button>
    </div>
  </header>

  <div id="sideMenuOverlay" tabindex="-1"></div>
  <aside id="sideMenu" aria-label="Main menu" role="navigation">
    <button id="closeMenuBtn" aria-label="Close menu" title="Close menu">×</button>
    <h2>Menu</h2>
    <nav>
      <a href="#" id="profileLink">Profile</a>
      <a href="#" id="settingsLink">Settings</a>
      <a href="#" id="resetPasswordLink">Reset Password</a>
      <a href="#" id="logoutLink">Logout</a>
    </nav>
  </aside>

  <div class="container">

    <div class="content">
      <div class="leaderboard-container">
        <div class="leaderboard-header">
          <button class="create-leaderboard-btn" onclick="openCreateModal()">
            <span>+</span> Create Leaderboard
          </button>
        </div>

        <table class="leaderboard-table">
          <thead>
            <tr>
              <th>Challenge Type</th>
              <th>Metrics</th>
              <th>Sports</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Name</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="leaderboardTableBody">
            <!-- Leaderboard rows will be rendered here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Create Leaderboard Modal -->
  <div class="modal" id="createModal">
    <div class="modal-content" id="createModalContent">
      <div class="modal-header">
        <h3 id="createModalTitle">Challenge Type</h3>
        <button class="close-btn" id="createModalCloseBtn">&times;</button>
      </div>
      <div class="modal-steps">
        <!-- Step 1: Challenge Type -->
        <div class="modal-step" id="step1">
          <label style="font-weight:600; font-size:16px; margin-bottom:10px; display:block;">Let's get started. Pick your challenge type.</label>
          <div class="challenge-type-options">
            <button type="button" class="challenge-type-btn" data-type="group_goal">
              <div class="ct-widget">
                <span class="ct-icon">🤝</span>
                <div class="ct-widget-text">
                  <div class="ct-title" style="font-weight: bold; font-size: 20px; margin-bottom: 6px;">Group Goal</div>
                  <div class="ct-desc" style="font-weight: normal; font-size: 15px;">Chase a goal as a group. All activities will count towards a single goal.</div>
                </div>
              </div>
            </button>
            <button type="button" class="challenge-type-btn" data-type="most_activity">
              <div class="ct-widget">
                <span class="ct-icon">🔥</span>
                <div class="ct-widget-text">
                  <div class="ct-title" style="font-weight: bold; font-size: 20px; margin-bottom: 6px;">Most Activity</div>
                  <div class="ct-desc" style="font-weight: normal; font-size: 15px;">Log as much distance, time, elevation or steps as you can during the challenge period.</div>
                </div>
              </div>
            </button>
            <button type="button" class="challenge-type-btn" data-type="fastest_effort">
              <div class="ct-widget">
                <span class="ct-icon">⚡</span>
                <div class="ct-widget-text">
                  <div class="ct-title" style="font-weight: bold; font-size: 20px; margin-bottom: 6px;">Fastest Effort</div>
                  <div class="ct-desc" style="font-weight: normal; font-size: 15px;">Upload the fastest run over a set distance.</div>
                </div>
              </div>
            </button>
            <button type="button" class="challenge-type-btn" data-type="longest_single_activity">
              <div class="ct-widget">
                <span class="ct-icon">🏆</span>
                <div class="ct-widget-text">
                  <div class="ct-title" style="font-weight: bold; font-size: 20px; margin-bottom: 6px;">Longest Single Activity</div>
                  <div class="ct-desc" style="font-weight: normal; font-size: 15px;">Log the most distance in one activity.</div>
                </div>
              </div>
            </button>
          </div>
          <div style="margin-top:18px; text-align:right;">
            <button type="button" class="submit-btn" id="toStep2Btn" disabled>Next</button>
          </div>
        </div>
        <!-- Step 2: Metrics -->
        <div class="modal-step" id="step2" style="display:none;">
          <label style="font-weight:600; font-size:16px; margin-bottom:10px; display:block;">What do you want to track?</label>
          <div class="metrics-options">
            <label><input type="checkbox" class="metric-checkbox" value="distance"> Distance</label><br>
            <label><input type="checkbox" class="metric-checkbox" value="time"> Time</label><br>
            <label><input type="checkbox" class="metric-checkbox" value="elevation"> Elevation</label><br>
            <label><input type="checkbox" class="metric-checkbox" value="steps"> Steps</label>
          </div>
          <div style="margin-top:18px; display:flex; justify-content:space-between;">
            <button type="button" class="submit-btn" id="backToStep1Btn">Back</button>
            <button type="button" class="submit-btn" id="toStep3Btn">Next</button>
          </div>
        </div>
        <!-- Step 3: Sports -->
        <div class="modal-step" id="step3" style="display:none;">
          <label style="font-weight:600; font-size:16px; margin-bottom:10px; display:block;">Which sports will count towards your challenge?</label>
          <div class="sports-options">
            <label><input type="checkbox" class="sport-checkbox" value="ride" id="sportRide"> Ride</label>
            <label><input type="checkbox" class="sport-checkbox" value="run" id="sportRun"> Run</label>
            <label><input type="checkbox" class="sport-checkbox" value="swim" id="sportSwim"> Swim</label>
            <label><input type="checkbox" class="sport-checkbox" value="hike" id="sportHike"> Hike</label>
            <label><input type="checkbox" class="sport-checkbox" value="walk" id="sportWalk"> Walk</label>
          </div>
          <div style="margin:10px 0 0 0;">
            <label><input type="checkbox" id="selectAllSports"> Select All</label>
          </div>
          <div style="margin-top:18px; display:flex; justify-content:space-between;">
            <button type="button" class="submit-btn" id="backToStep2Btn">Back</button>
            <button type="button" class="submit-btn" id="toStep4Btn">Next</button>
          </div>
        </div>
        <!-- Step 4: Dates -->
        <div class="modal-step" id="step4" style="display:none;">
          <label style="font-weight:600; font-size:16px; margin-bottom:10px; display:block;">Choose when to kick off your challenge</label>
          <div class="form-group">
            <label for="challengeStartDate">Start Date</label>
            <input type="date" id="challengeStartDate" required>
          </div>
          <div class="form-group">
            <label for="challengeEndDate">End Date</label>
            <input type="date" id="challengeEndDate" required>
          </div>
          <div style="margin-top:18px; display:flex; justify-content:space-between;">
            <button type="button" class="submit-btn" id="backToStep3Btn">Back</button>
            <button type="button" class="submit-btn" id="toStep5Btn">Next</button>
          </div>
        </div>
        <!-- Step 5: Name/Description -->
        <div class="modal-step" id="step5" style="display:none;">
          <label style="font-weight:600; font-size:16px; margin-bottom:10px; display:block;">Give your challenge a name and description (optional)</label>
          <div class="form-group">
            <label for="challengeName">Name</label>
            <input type="text" id="challengeName" maxlength="50" placeholder="e.g. Summer Step Challenge">
          </div>
          <div class="form-group">
            <label for="challengeDesc">Description</label>
            <textarea id="challengeDesc" maxlength="200" placeholder="Describe your challenge (optional)"></textarea>
          </div>
          <div style="margin-top:18px; display:flex; justify-content:space-between;">
            <button type="button" class="submit-btn" id="backToStep4Btn">Back</button>
            <button type="button" class="submit-btn" id="finishCreateBtn">Finish</button>
          </div>
        </div>
      </div>
    </div>
  </div>
    /* Multi-step modal styles */
    .sports-options {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 8px;
    }
    .sports-options label {
      font-size: 15px;
      margin-bottom: 6px;
      display: block;
      cursor: pointer;
      min-width: 80px;
    }
    .sports-options input[type="checkbox"] {
      margin-right: 8px;
      accent-color: var(--primary);
    }
    .modal-steps {
      min-width: 260px;
      min-height: 180px;
      position: relative;
      overflow: hidden;
    }
    .modal-step {
      transition: transform 0.4s cubic-bezier(.4,2,.6,1), opacity 0.3s;
      will-change: transform, opacity;
    }
    .challenge-type-options {
      display: flex;
      flex-direction: column;
      gap: 18px;
      margin-bottom: 16px;
      width: 100%;
      align-items: center;
      padding-bottom: 8px;
    }
    .ct-row {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .ct-title {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.2px;
      margin-bottom: 0;
      margin-top: 0;
    }
    .ct-desc {
      font-size: 15px;
      color: #222;
      margin: 16px 0 0 0;
      text-align: center;
      font-weight: 400;
      line-height: 1.5;
      max-width: 95%;
      letter-spacing: 0.01em;
      min-height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    body.dark .ct-desc {
      color: #f1f1f1;
    }
    @keyframes popIn {
      0% { transform: scale(0.5); opacity: 0; }
      80% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    /* removed duplicate .challenge-type-btn and .challenge-type-btn:hover:not(.selected) for redesign */
    .metrics-options label {
      font-size: 15px;
      margin-bottom: 6px;
      display: block;
      cursor: pointer;
    }
    .metrics-options input[type="checkbox"] {
      margin-right: 8px;
      accent-color: var(--primary);
    }

  <!-- Edit Leaderboard Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Leaderboard</h3>
        <button class="close-btn" id="editModalCloseBtn">&times;</button>
      </div>
      <form id="editLeaderboardForm">
        <div style="margin-bottom:18px;">
          <h4 style="margin-bottom:8px; color:#007bff;">Challenge Info</h4>
          <div class="form-group">
            <label for="editChallengeType">Challenge Type</label>
            <select id="editChallengeType" required>
              <option value="Group Goal">Group Goal</option>
              <option value="Most Activity">Most Activity</option>
              <option value="Fastest Effort">Fastest Effort</option>
              <option value="Longest Single Activity">Longest Single Activity</option>
            </select>
          </div>
        </div>
        <div style="margin-bottom:18px;">
          <h4 style="margin-bottom:8px; color:#007bff;">Metrics</h4>
          <div class="form-group" style="flex-direction:row; flex-wrap:wrap; gap:18px;">
            <label><input type="checkbox" class="edit-metric-checkbox" value="distance"> Distance</label>
            <label><input type="checkbox" class="edit-metric-checkbox" value="time"> Time</label>
            <label><input type="checkbox" class="edit-metric-checkbox" value="elevation"> Elevation</label>
            <label><input type="checkbox" class="edit-metric-checkbox" value="steps"> Steps</label>
          </div>
        </div>
        <div style="margin-bottom:18px;">
          <h4 style="margin-bottom:8px; color:#007bff;">Sports</h4>
          <div class="form-group" style="flex-direction:row; flex-wrap:wrap; gap:18px;">
            <label><input type="checkbox" class="edit-sport-checkbox" value="ride"> Ride</label>
            <label><input type="checkbox" class="edit-sport-checkbox" value="run"> Run</label>
            <label><input type="checkbox" class="edit-sport-checkbox" value="swim"> Swim</label>
            <label><input type="checkbox" class="edit-sport-checkbox" value="hike"> Hike</label>
            <label><input type="checkbox" class="edit-sport-checkbox" value="walk"> Walk</label>
          </div>
        </div>
        <div style="margin-bottom:18px;">
          <h4 style="margin-bottom:8px; color:#007bff;">Dates</h4>
          <div class="form-group">
            <label for="editStartDate">Start Date</label>
            <input type="date" id="editStartDate" required>
          </div>
          <div class="form-group">
            <label for="editEndDate">End Date</label>
            <input type="date" id="editEndDate" required>
          </div>
        </div>
        <div style="margin-bottom:18px;">
          <h4 style="margin-bottom:8px; color:#007bff;">Details</h4>
          <div class="form-group">
            <label for="editLeaderboardName">Name</label>
            <input type="text" id="editLeaderboardName" required>
          </div>
          <div class="form-group">
            <label for="editLeaderboardDescription">Description</label>
            <textarea id="editLeaderboardDescription" required></textarea>
          </div>
        </div>
        <button type="submit" class="submit-btn">Update</button>
      </form>
    </div>
  </div>

  <script type="module">
    // Back button: go back or fallback to BusinessUser.html
    const backBtn = document.getElementById('backBtn');
    if (backBtn) {
      backBtn.addEventListener("click", () => {
        if (window.history.length > 1) {
          history.back();
        } else {
          window.location.href = "BusinessUser.html";
        }
      });
    }

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAIFV7ynXUzA0p-CrmVOE2lFRgaf_9g_k4",
      authDomain: "fyp-25-s2-09.firebaseapp.com",
      projectId: "fyp-25-s2-09",
      storageBucket: "fyp-25-s2-09.appspot.com",
      messagingSenderId: "838641447649",
      appId: "1:838641447649:web:6ddfb234b3d445f16dbda0"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);


    const menuBtn = document.getElementById('menuBtn');
    const modeToggle = document.getElementById('modeToggle');
    const sideMenu = document.getElementById('sideMenu');
    const sideMenuOverlay = document.getElementById('sideMenuOverlay');
    const closeMenuBtn = document.getElementById('closeMenuBtn');
    const logoutLink = document.getElementById('logoutLink');
    const resetPasswordLink = document.getElementById('resetPasswordLink');
    const profileLink = document.getElementById('profileLink');
    const settingsLink = document.getElementById('settingsLink');
    const headerTitle = document.getElementById('headerTitle');

    // Modal elements
    const createModal = document.getElementById("createModal");
    const editModal = document.getElementById("editModal");
    const createLeaderboardForm = document.getElementById("createLeaderboardForm");
    const editLeaderboardForm = document.getElementById("editLeaderboardForm");

    // Side menu open/close functions
    function openMenu() {
      sideMenu.classList.add("active");
      sideMenuOverlay.classList.add("active");
    }
    function closeMenu() {
      sideMenu.classList.remove("active");
      sideMenuOverlay.classList.remove("active");
    }
    menuBtn.addEventListener("click", openMenu);
    closeMenuBtn.addEventListener("click", closeMenu);
    sideMenuOverlay.addEventListener("click", closeMenu);

    // Dark mode toggle
    modeToggle.addEventListener("click", () => {
      const isDark = document.body.classList.toggle("dark");
      modeToggle.textContent = isDark ? "☀️" : "🌙";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
      modeToggle.textContent = "☀️";
    }

    // Side menu navigation links
    profileLink.addEventListener("click", (e) => {
      e.preventDefault();
      goProfile();
      closeMenu();
    });
    settingsLink.addEventListener("click", (e) => {
      e.preventDefault();
      goSettings();
      closeMenu();
    });
    logoutLink.addEventListener("click", async (e) => {
      e.preventDefault();
      await logout();
      closeMenu();
    });
    resetPasswordLink.addEventListener("click", (e) => {
      e.preventDefault();
      resetPassword();
      closeMenu();
    });

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "Login.html";
      } else {
        headerTitle.textContent = "Leaderboard Management";
      }
    });

    // Firebase imports for Firestore
    import { collection, addDoc, getDocs, deleteDoc, doc as firestoreDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // Render leaderboard table from Firestore
    async function renderLeaderboardTable() {
      const tbody = document.getElementById('leaderboardTableBody');
      tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; color:#888;">Loading...</td></tr>';
      try {
        const querySnapshot = await getDocs(collection(db, "leaderboard"));
        let rows = '';
        function formatDate(iso) {
          if (!iso) return '';
          const [y, m, d] = iso.split('-');
          if (!y || !m || !d) return iso;
          return `${d}/${m}/${y}`;
        }
        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          rows += `
            <tr>
              <td>${data.challengeType || ''}</td>
              <td>${(data.metrics || []).map(m => m.charAt(0).toUpperCase() + m.slice(1)).join(', ')}</td>
              <td>${(data.sports || []).map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(', ')}</td>
              <td>${formatDate(data.startDate)}</td>
              <td>${formatDate(data.endDate)}</td>
              <td>${data.name ? data.name.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') : ''}</td>
              <td>${data.description ? data.description.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') : ''}</td>
              <td class="leaderboard-actions">
                <button class="action-btn view-btn" title="View" onclick="viewLeaderboard('${docSnap.id}')">View</button>
                <button class="action-btn edit-btn" title="Edit" onclick="editLeaderboard('${docSnap.id}')">Edit</button>
                <button class="action-btn delete-btn" title="Delete" onclick="deleteLeaderboard('${docSnap.id}')">Delete</button>
              </td>
            </tr>
          `;
        });
        tbody.innerHTML = rows || '<tr><td colspan="8" style="text-align:center; color:#888;">No leaderboards found.</td></tr>';
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center; color:#c00;">Failed to load: ${err.message}</td></tr>`;
      }
    }

    // Call on page load
    renderLeaderboardTable();
    let selectedChallengeType = null;
    let selectedMetrics = [];
    let selectedSports = [];
    let selectedStartDate = '';
    let selectedEndDate = '';
    let enteredName = '';
    let enteredDesc = '';
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const step4 = document.getElementById('step4');
    const step5 = document.getElementById('step5');
    const toStep2Btn = document.getElementById('toStep2Btn');
    const backToStep1Btn = document.getElementById('backToStep1Btn');
    const toStep3Btn = document.getElementById('toStep3Btn');
    const backToStep2Btn = document.getElementById('backToStep2Btn');
    const toStep4Btn = document.getElementById('toStep4Btn');
    const backToStep3Btn = document.getElementById('backToStep3Btn');
    const toStep5Btn = document.getElementById('toStep5Btn');
    const backToStep4Btn = document.getElementById('backToStep4Btn');
    const finishCreateBtn = document.getElementById('finishCreateBtn');
    const challengeTypeBtns = document.querySelectorAll('.challenge-type-btn');
    const metricCheckboxes = document.querySelectorAll('.metric-checkbox');
    const sportCheckboxes = document.querySelectorAll('.sport-checkbox');
    const selectAllSports = document.getElementById('selectAllSports');
    const challengeStartDate = document.getElementById('challengeStartDate');
    const challengeEndDate = document.getElementById('challengeEndDate');
    const challengeNameInput = document.getElementById('challengeName');
    const challengeDescInput = document.getElementById('challengeDesc');
    const createModalTitle = document.getElementById('createModalTitle');

    function openCreateModal() {
      createModal.style.display = "flex";
      // Reset steps
      step1.style.display = '';
      step2.style.display = 'none';
      step3.style.display = 'none';
      step4.style.display = 'none';
      step5.style.display = 'none';
      createModalTitle.textContent = 'Challenge Type';
      // Reset selections
      challengeTypeBtns.forEach(btn => btn.classList.remove('selected'));
      toStep2Btn.disabled = true;
      selectedChallengeType = null;
      metricCheckboxes.forEach(cb => cb.checked = false);
      selectedMetrics = [];
      sportCheckboxes.forEach(cb => cb.checked = false);
      selectAllSports.checked = false;
      selectedSports = [];
      challengeStartDate.value = '';
      challengeEndDate.value = '';
      challengeNameInput.value = '';
      challengeDescInput.value = '';
      enteredName = '';
      enteredDesc = '';
    }

    // Attach event listener for close button in create modal
    const createCloseBtn = document.getElementById('createModalCloseBtn');
    if (createCloseBtn) {
      createCloseBtn.addEventListener('click', closeCreateModal);
    }
    // Expose to global for button onclick
    window.openCreateModal = openCreateModal;

    function closeCreateModal() {
      createModal.style.display = "none";
    }

    // Step 1: Challenge type selection
    challengeTypeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        challengeTypeBtns.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedChallengeType = btn.getAttribute('data-type');
        toStep2Btn.disabled = false;
      });
    });

    // Step 2: Metrics
    toStep2Btn.addEventListener('click', () => {
      step1.style.display = 'none';
      step2.style.display = '';
      step3.style.display = 'none';
      step4.style.display = 'none';
      step5.style.display = 'none';
      createModalTitle.textContent = 'Leaderboard Metrics';
    });
    backToStep1Btn.addEventListener('click', () => {
      step2.style.display = 'none';
      step1.style.display = '';
      step3.style.display = 'none';
      step4.style.display = 'none';
      step5.style.display = 'none';
      createModalTitle.textContent = 'Create Leaderboard';
    });

    // Step 3: Sports
    toStep3Btn.addEventListener('click', () => {
      // Validate metrics
      selectedMetrics = Array.from(metricCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
      if (selectedMetrics.length === 0) {
        alert('Please select at least one metric to track.');
        return;
      }
      step2.style.display = 'none';
      step3.style.display = '';
      step1.style.display = 'none';
      step4.style.display = 'none';
      step5.style.display = 'none';
      createModalTitle.textContent = 'Select Sports';
    });
    backToStep2Btn.addEventListener('click', () => {
      step3.style.display = 'none';
      step2.style.display = '';
      step1.style.display = 'none';
      step4.style.display = 'none';
      step5.style.display = 'none';
      createModalTitle.textContent = 'Leaderboard Metrics';
    });
    // Select All Sports logic
    selectAllSports.addEventListener('change', () => {
      sportCheckboxes.forEach(cb => cb.checked = selectAllSports.checked);
    });
    sportCheckboxes.forEach(cb => {
      cb.addEventListener('change', () => {
        if (!cb.checked) selectAllSports.checked = false;
        else if (Array.from(sportCheckboxes).every(c => c.checked)) selectAllSports.checked = true;
      });
    });

    // Step 4: Dates
    toStep4Btn.addEventListener('click', () => {
      selectedSports = Array.from(sportCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
      if (selectedSports.length === 0) {
        alert('Please select at least one sport.');
        return;
      }
      step3.style.display = 'none';
      step4.style.display = '';
      step1.style.display = 'none';
      step2.style.display = 'none';
      step5.style.display = 'none';
      createModalTitle.textContent = 'Challenge Dates';
    });
    backToStep3Btn.addEventListener('click', () => {
      step4.style.display = 'none';
      step3.style.display = '';
      step1.style.display = 'none';
      step2.style.display = 'none';
      step5.style.display = 'none';
      createModalTitle.textContent = 'Select Sports';
    });

    // Step 5: Name/Description
    toStep5Btn.addEventListener('click', () => {
      selectedStartDate = challengeStartDate.value;
      selectedEndDate = challengeEndDate.value;
      if (!selectedStartDate || !selectedEndDate) {
        alert('Please select both start and end dates.');
        return;
      }
      if (selectedEndDate < selectedStartDate) {
        alert('End date cannot be before start date.');
        return;
      }
      step4.style.display = 'none';
      step5.style.display = '';
      step1.style.display = 'none';
      step2.style.display = 'none';
      step3.style.display = 'none';
      createModalTitle.textContent = 'Challenge Name & Description';
    });
    backToStep4Btn.addEventListener('click', () => {
      step5.style.display = 'none';
      step4.style.display = '';
      step1.style.display = 'none';
      step2.style.display = 'none';
      step3.style.display = 'none';
      createModalTitle.textContent = 'Challenge Dates';
    });

    // Finish
    finishCreateBtn.addEventListener('click', async () => {
      enteredName = challengeNameInput.value.trim();
      enteredDesc = challengeDescInput.value.trim();
      // Validate all required fields again
      if (!selectedChallengeType) {
        alert('Please select a challenge type.');
        return;
      }
      if (selectedMetrics.length === 0) {
        alert('Please select at least one metric to track.');
        return;
      }
      if (selectedSports.length === 0) {
        alert('Please select at least one sport.');
        return;
      }
      if (!selectedStartDate || !selectedEndDate) {
        alert('Please select both start and end dates.');
        return;
      }
      if (selectedEndDate < selectedStartDate) {
        alert('End date cannot be before start date.');
        return;
      }
      // Compose name/description
      let challengeTypeLabel = '';
      switch(selectedChallengeType) {
        case 'group_goal': challengeTypeLabel = 'Group Goal'; break;
        case 'most_activity': challengeTypeLabel = 'Most Activity'; break;
        case 'fastest_effort': challengeTypeLabel = 'Fastest Effort'; break;
        case 'longest_single_activity': challengeTypeLabel = 'Longest Single Activity'; break;
        default: challengeTypeLabel = selectedChallengeType;
      }
      const name = enteredName || `${challengeTypeLabel} Leaderboard`;
      const description = enteredDesc;

      // Save to Firestore
      try {
        await addDoc(collection(db, "leaderboard"), {
          challengeType: challengeTypeLabel,
          metrics: selectedMetrics,
          sports: selectedSports,
          startDate: selectedStartDate,
          endDate: selectedEndDate,
          name: name,
          description: description
        });
        closeCreateModal();
        renderLeaderboardTable();
      } catch (err) {
        alert('Failed to create leaderboard: ' + err.message);
      }
    });


// Track which leaderboard is being edited
let editingLeaderboardId = null;
// Edit leaderboard: fetch by id and fill modal
async function editLeaderboard(id) {
  try {
    const docRef = doc(db, "leaderboard", id);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      const data = docSnap.data();
      document.getElementById("editChallengeType").value = data.challengeType || '';
      // Metrics
      const metricCheckboxes = document.querySelectorAll('.edit-metric-checkbox');
      (data.metrics || []).forEach(metric => {
        metricCheckboxes.forEach(cb => {
          cb.checked = (cb.value === metric);
        });
      });
      // Sports
      const sportCheckboxes = document.querySelectorAll('.edit-sport-checkbox');
      (data.sports || []).forEach(sport => {
        sportCheckboxes.forEach(cb => {
          cb.checked = (cb.value === sport);
        });
      });
      document.getElementById("editStartDate").value = data.startDate || '';
      document.getElementById("editEndDate").value = data.endDate || '';
      document.getElementById("editLeaderboardName").value = data.name || '';
      document.getElementById("editLeaderboardDescription").value = data.description || '';
      editModal.style.display = "flex";
      editingLeaderboardId = id;
    } else {
      alert("Leaderboard not found.");
    }
  } catch (err) {
    alert("Failed to load leaderboard: " + err.message);
  }
}
// Expose for inline onclick
window.editLeaderboard = editLeaderboard;


    function closeEditModal() {
      editModal.style.display = "none";
    }
    // Attach event listener for close button in edit modal
    const editCloseBtn = document.getElementById('editModalCloseBtn');
    if (editCloseBtn) {
      editCloseBtn.addEventListener('click', closeEditModal);
    }

    // View leaderboard (placeholder)
    function viewLeaderboard(id) {
      alert(`Viewing leaderboard: ${id}\n(Not implemented - would show ranking and points)`);
    }

    // Delete leaderboard from Firestore
    async function deleteLeaderboard(id) {
      if (confirm(`Are you sure you want to delete this leaderboard?`)) {
        try {
          await deleteDoc(firestoreDoc(db, "leaderboard", id));
          renderLeaderboardTable();
        } catch (err) {
          alert('Failed to delete leaderboard: ' + err.message);
        }
      }
    }

    // Expose for inline onclick
    window.viewLeaderboard = viewLeaderboard;
    window.deleteLeaderboard = deleteLeaderboard;

    createLeaderboardForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("leaderboardName").value;
      const description = document.getElementById("leaderboardDescription").value;
      
      alert(`Leaderboard "${name}" created (not implemented)`);
      closeCreateModal();
      // Here you would typically call a function to save the leaderboard to your database
    });


editLeaderboardForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  if (!editingLeaderboardId) {
    alert("No leaderboard selected for editing.");
    return;
  }
  // Gather all fields
  const challengeType = document.getElementById("editChallengeType").value;
  const metricCheckboxes = document.querySelectorAll('.edit-metric-checkbox');
  const metrics = Array.from(metricCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
  const sportCheckboxes = document.querySelectorAll('.edit-sport-checkbox');
  const sports = Array.from(sportCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
  const startDate = document.getElementById("editStartDate").value;
  const endDate = document.getElementById("editEndDate").value;
  const name = document.getElementById("editLeaderboardName").value;
  const description = document.getElementById("editLeaderboardDescription").value;
  // Validation
  if (!challengeType || metrics.length === 0 || sports.length === 0 || !startDate || !endDate || !name) {
    alert("Please fill in all required fields and select at least one metric and sport.");
    return;
  }
  if (endDate < startDate) {
    alert("End date cannot be before start date.");
    return;
  }
  try {
    const docRef = doc(db, "leaderboard", editingLeaderboardId);
    await updateDoc(docRef, { challengeType, metrics, sports, startDate, endDate, name, description });
    closeEditModal();
    editingLeaderboardId = null;
    renderLeaderboardTable();
  } catch (err) {
    alert("Failed to update leaderboard: " + err.message);
  }
});

    // Navigation functions
    window.logout = async () => {
      try {
        await signOut(auth);
        window.location.href = "Login.html";
      } catch (error) {
        console.error("Logout error:", error);
        alert("Failed to logout: " + error.message);
      }
    };

    window.goProfile = () => window.location.href = "Profile.html";
    window.goSettings = () => window.location.href = "Settings.html";
    window.resetPassword = () => {
      const user = auth.currentUser;
      if (!user || !user.email) {
        alert("No user logged in.");
        return;
      }
      const confirmReset = confirm(`Send password reset email to ${user.email}?`);
      if (confirmReset) {
        sendPasswordResetEmail(auth, user.email)
          .then(() => alert("Password reset email sent!"))
          .catch(err => alert("Error sending reset email: " + err.message));
      }
    };

    // Close modals when clicking outside
    window.addEventListener("click", (e) => {
      if (e.target === createModal) closeCreateModal();
      if (e.target === editModal) closeEditModal();
    });
  </script>
</body>
</html>